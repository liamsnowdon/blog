{% macro header(post) %}
  {% set category = data.categories | getById(post.category) %}

  <div class="post-hero" style="">
    <div class="l-content">
      <div class="post-hero__content">
        <div class="post-hero__left">
          <h1>{{ post.title }}</h1>
          <p>{{ post.intro }}</p>
        </div>
        
        <div class="post-hero__right">
          <h5><strong>Posted:</strong> {{ post.datePosted|longDate }}</h5>
          
          <h5><strong>Category:</strong> <a href="/categories/{{ category.file }}">{{ category.name }}</a></h5>
          
          {% if post.tags.length %}
            <h5>
              <strong>Tags:</strong>
              {% for tagId in post.tags %}
                {% set tag = data.tags | getById(tagId) %}
                
                <a href="/tags/{{ tag.file }}">{{ tag.name }}</a>
              {% endfor %}
            </h5>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endmacro %}

{% macro content(post) %}
  <div id="post" class="l-wrapper">
    <div class="l-content">
      <div class="post">
        <article class="post__article">
          <div>{{ post.content | safe }}</div>
        </article>

        <aside class="post__sidebar">
          {{ relatedPosts(post) }}
          {{ mostRecentInCategory(post) }}
        </aside>
      </div>
    </div>
  </div>
{% endmacro %}

{% macro relatedPosts(post) %}
  <div class="sidebar-pod">
    <div class="sidebar-pod__header">
        <h4>Related posts</h4>
    </div>

    <div class="sidebar-pod__content">
      {% for id in post.relatedPosts %}
        {% set relatedPost = data.posts | getById(id) %}

        <a class="sidebar-pod__row" href="/posts/{{ relatedPost.file }}" title="{{ relatedPost.title }}">
          <span class="sidebar-pod__title">{{ relatedPost.title }}</span>
          <span class="sidebar-pod__date">{{ relatedPost.datePosted|shortDate }}</span>
        </a>
      {% endfor %}

      {% if post.relatedPosts.length === 0 %}
        <div class="sidebar-pod__row is-empty">
            Could not find any related posts.
        </div>
      {% endif %}
    </div>
  </div>
{% endmacro %}

{% macro mostRecentInCategory(post) %}
  {% set category = data.categories | getById(post.category) %}

  <div class="sidebar-pod">
    <div class="sidebar-pod__header">
      <h4>Most recent in {{ category.name }}</h4>
    </div>
    <div class="sidebar-pod__content">
      {% for recentPost in data.posts|sort(true, true, 'datePosted') %}
        {% set recentPostCategory = data.categories | getById(recentPost.category) %}
        
        {% if recentPostCategory.name === category.name %}
          <a class="sidebar-pod__row" href="/posts/{{ recentPost.file }}" title="{{ recentPost.title }}">
            <span class="sidebar-pod__title">{{ recentPost.title }}</span>
            <span class="sidebar-pod__date">{{ recentPost.datePosted|shortDate }}</span>
          </a>
        {% endif %}
      {% endfor %}
  </div>
</div>
{% endmacro %}